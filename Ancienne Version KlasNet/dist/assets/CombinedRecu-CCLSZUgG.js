import{d as j,j as e,E as v,a as b}from"./index-CQL_eFg8.js";function R({eleve:h,paiements:x,classe:i,anneeScolaire:N,operateur:y}){const f=(x||[]).reduce((t,n)=>t+(Number(n.montant)||0),0),F="REC"+Date.now().toString().slice(-8);let u=0;if(i){const t=j.getAll("fraisScolaires").find(n=>n.niveau===i.niveau&&n.anneeScolaire===i.anneeScolaire);t&&t.echeances&&t.echeances.length&&(u=(t.echeances||[]).reduce((n,a)=>n+Number(a.montant||0),0))}const g=Math.max(0,u-f);let o=[];const p={},m={};if(i){const t=j.getAll("fraisScolaires").find(n=>n.niveau===i.niveau&&n.anneeScolaire===i.anneeScolaire);if(t&&t.echeances&&t.echeances.length){o=(t.echeances||[]).slice();for(const n of o){const a=n.id||`${t.niveau}-${n.modalite||0}`;p[a]=n,m[a]=0}}}for(let t=0;t<(x||[]).length;t++){const n=x[t],a=n&&n.allocations||[];if(a&&Array.isArray(a)&&a.length)for(const s of a){const r=s.echeanceId;m[r]=(m[r]||0)+Number(s.montant||0)}else{const s=n;let r=null;if(typeof s.modalite<"u"&&s.modalite!==null){const l=Number(s.modalite),c=o.find(d=>Number(d.modalite)===l);c&&(r=c.id||`${i.niveau}-${c.modalite}`)}if(!r){if(s.typeFrais==="inscription"){const l=o.find(c=>Number(c.modalite)===1);l&&(r=l.id||`${i.niveau}-${l.modalite}`)}else if(s.typeFrais==="scolarite"&&typeof s.versementIndex<"u"){const l=Number(s.versementIndex)+1,c=o.find(d=>Number(d.modalite)===l);c&&(r=c.id||`${i.niveau}-${c.modalite}`)}}if(!r){const l=Number(s.montant||0),c=o.find(d=>Number(d.montant||0)===l&&(m[d.id||`${i.niveau}-${d.modalite}`]||0)<Number(d.montant||0));c&&(r=c.id||`${i.niveau}-${c.modalite}`)}if(r){const l=p[r]||null;l?`${l.modalite||"?"}${(Number(s.montant)||0).toLocaleString("fr-FR")}`:`${r}${(Number(s.montant)||0).toLocaleString("fr-FR")}`,m[r]=(m[r]||0)+Number(s.montant||0)}}}return e.jsxs("div",{className:"p-4 print-compact",style:{pageBreakAfter:"always"},children:[e.jsx(v,{type:"recu",libelle:`Reçu combiné — ${N||""}`}),e.jsxs("div",{className:"mt-2 mb-4",children:[e.jsxs("div",{children:[e.jsx("strong",{children:"Élève:"})," ",h.prenoms," ",h.nom]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Classe:"})," ",i?`${i.niveau} ${i.section||""}`:""]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Matricule:"})," ",h.matricule||""]}),e.jsxs("div",{children:[e.jsx("strong",{children:"N° Reçu:"})," ",F]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold mb-2",children:"Détails des opérations"}),e.jsxs("table",{className:"w-full text-sm border-collapse",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"border px-2 py-1",children:"Date"}),e.jsx("th",{className:"border px-2 py-1",children:"Type"}),e.jsx("th",{className:"border px-2 py-1",children:"Montant"}),e.jsx("th",{className:"border px-2 py-1",children:"Affecté à"})]})}),e.jsx("tbody",{children:x.map((t,n)=>e.jsxs("tr",{children:[e.jsx("td",{className:"border px-2 py-1",children:new Date(t.datePaiement||t.date||Date.now()).toLocaleDateString("fr-FR")}),e.jsx("td",{className:"border px-2 py-1",children:t.typeFrais||"-"}),e.jsxs("td",{className:"border px-2 py-1 text-right",children:[(Number(t.montant)||0).toLocaleString("fr-FR")," FCFA"]}),e.jsx("td",{className:"border px-2 py-1 text-sm",children:(t&&t.allocations||[]).length?e.jsx("div",{children:(t.allocations||[]).map((a,s)=>{const r=a.echeanceId,l=p[r]||null,c=l?`V${l.modalite||"?"} (${(Number(a.montant)||0).toLocaleString("fr-FR")} FCFA)`:`${r} (${(Number(a.montant)||0).toLocaleString("fr-FR")} FCFA)`;return e.jsx("div",{children:c},s)})}):e.jsx("span",{className:"text-gray-500",children:"—"})})]},n))})]})]}),o&&o.length>0&&e.jsxs("div",{className:"mt-4",children:[e.jsx("h4",{className:"font-semibold mb-2",children:"Résumé des échéances"}),e.jsxs("table",{className:"w-full text-sm border-collapse",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"border px-2 py-1",children:"Modalité"}),e.jsx("th",{className:"border px-2 py-1",children:"Date"}),e.jsx("th",{className:"border px-2 py-1",children:"Attendu"}),e.jsx("th",{className:"border px-2 py-1",children:"Payé"}),e.jsx("th",{className:"border px-2 py-1",children:"Reste"})]})}),e.jsx("tbody",{children:o.map(t=>{const n=t.id||`${i.niveau}-${t.modalite}`,a=m[n]||0,s=Number(t.montant||0),r=Math.max(0,s-a);return e.jsxs("tr",{children:[e.jsxs("td",{className:"border px-2 py-1",children:["V",t.modalite]}),e.jsx("td",{className:"border px-2 py-1",children:t.date}),e.jsxs("td",{className:"border px-2 py-1 text-right",children:[s.toLocaleString("fr-FR")," FCFA"]}),e.jsxs("td",{className:"border px-2 py-1 text-right",children:[a.toLocaleString("fr-FR")," FCFA"]}),e.jsxs("td",{className:"border px-2 py-1 text-right",children:[r.toLocaleString("fr-FR")," FCFA"]})]},n)})})]})]}),e.jsxs("div",{className:"mt-4 text-right font-bold",children:[e.jsxs("div",{children:["Total payé : ",f.toLocaleString("fr-FR")," FCFA"]}),e.jsxs("div",{children:["Total attendu : ",u.toLocaleString("fr-FR")," FCFA"]}),e.jsxs("div",{children:["Reste à payer : ",g.toLocaleString("fr-FR")," FCFA"]})]}),e.jsxs("div",{className:"mt-6 text-sm",children:["Opérateur: ",y||(b()?`${b().prenoms} ${b().nom}`:"Inconnu")]}),e.jsx("div",{className:"flex flex-col mt-4",children:e.jsxs("div",{className:"mt-auto text-xs text-gray-500 border-t pt-2 text-center",children:[e.jsx("div",{className:"mb-1",children:"Aucun remboursement n'est possible après encaissement."}),e.jsxs("div",{className:"italic",children:["Imprimé le ",new Date().toLocaleDateString("fr-FR")]})]})})]})}export{R as default};
